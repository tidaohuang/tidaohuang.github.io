<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_51) on Thu Nov 21 01:57:12 IST 2019 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>wt.pom (WNC.HORSE.10.00.602)</title>
<meta name="date" content="2019-11-21">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="wt.pom (WNC.HORSE.10.00.602)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-files/index-1.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../wt/pds/subStringIndex/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../wt/pom/concurrent/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../index.html?wt/pom/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;wt.pom</h1>
<div class="docSummary">
<div class="block">Provides low-level, yet database independent, access to a database.</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Interface Summary table, listing interfaces, and an explanation">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../wt/pom/TransactionCommitListener.html" title="interface in wt.pom">TransactionCommitListener</a></td>
<td class="colLast">
<div class="block">This interface specifies methods for processing that occurs at the end
 of a transaction after normal work is completed, but before the transaction
 is committed.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../wt/pom/TransactionListener.html" title="interface in wt.pom">TransactionListener</a></td>
<td class="colLast">
<div class="block">This interface specifies methods for listening to transaction commits
 and rollbacks.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../wt/pom/Transaction.html" title="class in wt.pom">Transaction</a></td>
<td class="colLast">
<div class="block">Transaction provides interfaces to create transaction blocks.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Exception Summary table, listing exceptions, and an explanation">
<caption><span>Exception Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Exception</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../wt/pom/ConnectionException.html" title="class in wt.pom">ConnectionException</a></td>
<td class="colLast">
<div class="block">ConnectionException captures errors with a datastore connect/disconnect.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../wt/pom/ConnectionLostException.html" title="class in wt.pom">ConnectionLostException</a></td>
<td class="colLast">
<div class="block">ConnectionLostException captures errors with a datastore interaction.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../wt/pom/DatastoreException.html" title="class in wt.pom">DatastoreException</a></td>
<td class="colLast">
<div class="block">DatastoreException captures errors with a datastore interaction.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../wt/pom/DeadlockDetectedException.html" title="class in wt.pom">DeadlockDetectedException</a></td>
<td class="colLast">
<div class="block">DeadlockDetectedException captures deadlock detection during a datastore 
 interaction.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../wt/pom/ObjectIsPersistentException.html" title="class in wt.pom">ObjectIsPersistentException</a></td>
<td class="colLast">
<div class="block">ObjectIsPersistentException captures errors with a datastore interaction.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../wt/pom/ObjectIsStaleException.html" title="class in wt.pom">ObjectIsStaleException</a></td>
<td class="colLast">
<div class="block">ObjectIsStaleException captures errors with a datastore interaction.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../wt/pom/ObjectLockedException.html" title="class in wt.pom">ObjectLockedException</a></td>
<td class="colLast">
<div class="block">ObjectLockedException captures errors with a datastore interaction.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../wt/pom/ObjectNotPersistentException.html" title="class in wt.pom">ObjectNotPersistentException</a></td>
<td class="colLast">
<div class="block">ObjectNotPersistentException captures errors with a datastore interaction.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../wt/pom/PagingFetchTimeOutException.html" title="class in wt.pom">PagingFetchTimeOutException</a></td>
<td class="colLast">
<div class="block">PagingFetchTimeOutException captures errors when fetching pages.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../wt/pom/PagingSessionCacheSizeLimitException.html" title="class in wt.pom">PagingSessionCacheSizeLimitException</a></td>
<td class="colLast">
<div class="block">This exception captures errors when attempting to fetch pages from a paging
 session that has timed out.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../wt/pom/PagingSessionCacheTimeOutException.html" title="class in wt.pom">PagingSessionCacheTimeOutException</a></td>
<td class="colLast">
<div class="block">This exception captures errors when attempting to fetch pages from a paging
 session that has timed out.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../wt/pom/PersistenceException.html" title="class in wt.pom">PersistenceException</a></td>
<td class="colLast">
<div class="block">PersistenceException is the super class of all exceptions in the wt.pom package.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../wt/pom/POMInitException.html" title="class in wt.pom">POMInitException</a></td>
<td class="colLast">
<div class="block">This exception is thrown when an error occurs during Persistent Object
 Manager (POM) initialization.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../wt/pom/UniquenessException.html" title="class in wt.pom">UniquenessException</a></td>
<td class="colLast">
<div class="block">UniquenessException captures errors with a datastore interaction.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package.description">
<!--   -->
</a>
<h2 title="Package wt.pom Description">Package wt.pom Description</h2>
<div class="block">Provides low-level, yet database independent, access to a database. See <a href="../../wt/fc/PersistenceManager.html" title="interface in wt.fc"><code>PersistenceManager</code></a>
for the higher-level access that most developers will use.
<H3>
Transaction
</H3>
<p>
The following transaction features are supported.
</p>

<H4>
Nested Transaction Context
</H4>
<p>
The <a href="../../wt/pom/Transaction.html" title="class in wt.pom"><code>Transaction</code></a> class provides methods for creating transaction blocks. The <a href="../../wt/pom/Transaction.html#start--"><code>Transaction.start()</code></a> method
must always be paired with either a <a href="../../wt/pom/Transaction.html#commit--"><code>Transaction.commit()</code></a> or <a href="../../wt/pom/Transaction.html#rollback--"><code>Transaction.rollback()</code></a> to form a transaction 
block. In between these calls, other code can be invoked which can also create transaction blocks.  These blocks would be considered
nested within each other.  The common pattern for ensuring that transaction blocks are created correctly uses the try/finally
construct.
</p>
<code><pre>
Transaction trx = new Transaction();
try 
{
  trx.start();
  
  // Do transaction work

  if(/* successfull */)
  {
    trx.commit();
    trx = null;
  }
}
finally 
{
  if(trx != null) 
  {
    trx.rollback();
  }
}
</pre></code>
<p>
This code will always guarantee that either a commit or rollback will be executed.  If the work is not succesfull or an exception is 
thrown, then <code>trx</code> will not be set to null, so the rollback will execute. 
</p>

<H4>
Commit and Rollback
</H4>
<p>
Although <a href="../../wt/pom/Transaction.html" title="class in wt.pom"><code>Transaction</code></a> programatically supports nesting, the database supports only a single flat transaction. Internal 
state is maintained so that a database commit is only executed at the outer most nested transaction block. A database rollback at any 
nested block will cause the entire transaction to be rolled back immediately. 
</p>

<H4>
Listener Subscription and Notification
</H4>
<p>
The common pattern for listener subscription and notification is supported for the Transaction commit and rollback operations.  Two seperate listerner types are supported,
<a href="../../wt/pom/TransactionListener.html" title="interface in wt.pom"><code>TransactionListener</code></a> and <a href="../../wt/pom/TransactionCommitListener.html" title="interface in wt.pom"><code>TransactionCommitListener</code></a>.   TransactionListener instances can be added/ removed from
the local and global Transactions using 
<a href="../../wt/pom/Transaction.html#addLocalTransactionListener-wt.pom.TransactionListener-"><code>Transaction.addLocalTransactionListener(wt.pom.TransactionListener)</code></a>/<a href="../../wt/pom/Transaction.html#removeLocalTransactionListener-wt.pom.TransactionListener-"><code>Transaction.removeLocalTransactionListener(wt.pom.TransactionListener)</code></a> and 
<a href="../../wt/pom/Transaction.html#addTransactionListener-wt.pom.TransactionListener-"><code>Transaction.addTransactionListener(wt.pom.TransactionListener)</code></a>/<a href="../../wt/pom/Transaction.html#removeTransactionListener-wt.pom.TransactionListener-"><code>Transaction.removeTransactionListener(wt.pom.TransactionListener)</code></a>, respectively .
</p>

<p>
The following scenarios show the order of key steps for commit and rollback operations.  If an exception is thrown at any step, 
then the remaining steps are not completed.  Note that the order of notification to listeners is identical to the order in 
which they have been added.
</p>

<p>
The following is the order of operations for a commit to a Transaction that is nested.
</p>
<ol>
<li>
The method finishTransaction() is called on local TransactionListeners implementing the TransactionCommitListener interface.
</li>
<li>
The method beforeCompletion() is called on local TransactionListeners implementing the TransactionCommitListener interface.
</li>
<li>
The method notifyCommit() is called on local TransactionListeners.
</li>
</ol>

<p>
The following is the order of operations for a commit to a Transaction that is the outer-most (initial) in a nested block.
</p>
<ol>
<li>
The method finishTransaction() is called on local TransactionListeners implementing the TransactionCommitListener interface.
</li>
<li>
The method beforeCompletion() is called on local TransactionListeners implementing the TransactionCommitListener interface.
</li>
<li>
The method finishTransaction() is called on global TransactionListeners implementing the TransactionCommitListener interface.
</li>
<li>
The method finishTransaction() is called on global TransactionListeners implementing the TransactionCommitListener interface.
</li>
<li>
The method beforeCompletion() is called on global TransactionListeners implementing the TransactionCommitListener interface.
</li>
<li>
The database commit is executed.
</li>
<li>
The WTConnection associated with the Transaction is released.  Any new DB operations initiated would be in a separate global transaction.
</li>
<li>
The method notifyCommit() is called on global TransactionListeners.
</li>
<li>
The method notifyCommit() is called on local TransactionListeners.
</li>
</ol>


<p>
The following is the order of operations for a rollback to a Transaction that is nested, but is not the inner-most Transaction.
</p>
<ol>
<li>
The method notifyRollback() is called on local TransactionListeners.
</li>
</ol>


<p>
The following is the order of operations for a rollback to a Transaction that is the inner-most Transaction in a nested block.
</p>
<ol>
<li>
The database rollback is executed.
</li>
<li>
The WTConnection associated with the Transaction is released.  Any new DB operations initiated would be in a separate global transaction.
</li>
<li>
The method notifyRollback() is called on global TransactionListeners.
</li>
<li>
The method notifyRollback() is called on local TransactionListeners.
</li>
</ol>


<H4>
Key and Value Pair Storage and Lookup
</H4>

<p>
The nested transaction blocks support local and global java.util.Map attributes (<a href="../../wt/pom/Transaction.html#getLocalMap--"><code>Transaction.getLocalMap()</code></a> and 
<a href="../../wt/pom/Transaction.html#getGlobalMap--"><code>Transaction.getGlobalMap()</code></a>) that can be used for key/value pair storage as needed by the application.  Lookup 
methods are provided that access these Maps in the current Transaction stack.  Adding a key/value pair is accomplished 
by accessing the current transaction either through a local reference or a call to 
<a href="../../wt/pom/Transaction.html#getCurrentTransaction--"><code>Transaction.getCurrentTransaction()</code></a>.  The key/value pair can then be added to the local Map.  Accessing the keys or
associated values can be accomplished by searching the current Transaction or the entire nested Transaction block.  The lookup 
methods support searching for the existence of a key (<a href="../../wt/pom/Transaction.html#containsKeyInContext-java.lang.Object-boolean-boolean-"><code>Transaction.containsKeyInContext(java.lang.Object, boolean, boolean)</code></a>) and searching for the value 
associated with a key (<a href="../../wt/pom/Transaction.html#getInContext-java.lang.Object-boolean-boolean-"><code>Transaction.getInContext(java.lang.Object, boolean, boolean)</code></a>) similar to the Map lookup methods.  In addition, 
lookup methods also exist for returning the Transaction associated with the key (<a href="../../wt/pom/Transaction.html#findInContext-java.lang.Object-"><code>Transaction.findInContext(java.lang.Object)</code></a> and
<a href="../../wt/pom/Transaction.html#findAllInContext-java.lang.Object-"><code>Transaction.findAllInContext(java.lang.Object)</code></a>).  
</p>

<p>
Accessing key/value pairs in Transaction listeners during the commit or rollback operations is supported.  The following are
specific details concerning when the current Transaction and associated Maps are valid during these operations.  During a local commit, 
the local Transaction is still in context during the local finishTransaction() and beforeComplete() notifications, but it is 
removed from context in the local notifyCommit() notification.  For the outermost Transaction block, the global Transaction 
finishTransaction() and beforeComplete() notifications will occur while the outermost Transaction is still in context.  The 
outermost Transaction is removed from context before the global TransactionListeners notifyCommit() notification.  The global 
Transaction Map is removed after global TransactionListeners notifyCommit() notification.  During a local rollback(), the local 
Transaction is removed from context in the local notifyCommit() notification.  For the innermost Transaction block, the global 
Transaction notifyRollback() notification occurs after the outermost Transaction has been removed from context.  The global 
Transaction Map is removed before global TransactionListeners notifyRollback() notification.  
</p>

<H4>
Lock Monitoring
</H4>

<p>
The persistence layer can be configured to monitor the objects that are locked
as a result of persistence layer operations such as insert, update, delete,
and query (with lock).   This feature can be used to diagnose deadlock
situations and performance issues related to waiting to obtain database locks.   
If the log4j "wt.pom.transactionLockMonitor" logger is set to the
DEBUG level or lower, then the list of locked objects will be logged after every
transaction commits or rolls back.  If this logger is too verbose for a
situation, then the list of locked objects can be maintained internally in
memory for each database session.   The in-memory caching of lock information
is enabled by setting the log4j "wt.pom.sessionTransactionLockMonitor" logger
to INFO level or lower.   If the level is set to TRACE, then a stack trace that
is associated with the locking operation will also be stored.  By default, the
full set of locking information will only be logged if a database deadlock
error occurs.  A session may be considered "active".   This means that the session
has started a transaction, but it is not currently completed.  Once a commit or
rollback occurs for an active transaction, it is completed and no longer "active".
For database deadlock, only active sessions are logged.
</p>
<p>
There are also JMX capabilities associated with this
"wt.pom.sessionTransactionLockMonitor" logger.   If this logger is enabled, then
a cache is maintained that holds lock information for the last N transactions
where N is the size of the cache.   Each JDBC connection/database session has an
associated cache.  The "DB Connections" monitor MBean contains a
"TransactionLockMonitorSessionCacheSize" attribute for the cache size.   The
value can be adjusted to limit the amount of memory, but it should also be large
enough to ensure that the transaction "window" is adequate for analyzing deadlock
situations.  If the cache size attribute is modified via JMX, it will only affect 
caches that are created after the new value has been set.   Any existing sessions
that already have a cache will be sized based on the value at the time it was
created.  The "DB Connections" monitor MBean also contains a
"TransactionLockMonitorActiveSessionsPeriodicInterval" attribute for periodically
logging all active sessions.
</p>
<p>
The MBean also supports operations for explicitly logging session information.
The "dumpTransactionLockMonitorSessionCache" operation will log each session 
in the cache.  The "dumpTransactionLockMonitorActiveSession" operation will log 
only the active sessions.
</p>
<p>
The simplest approach for debugging and analyzing deadlock situation is to enable
"wt.pom.transactionLockMonitor" logging.  However, if the situation occurs 
infrequently or the logging output is too verbose, then this may not be practicle.
The "wt.pom.sessionTransactionLockMonitor" logging does not generate log messages
unless a deadlock occurs, an explicit JMX operation is invoked, or a periodic
interval has been set.  The internal cache size and overhead for collecting the
lock information will not significantly impact memory or performance.  For 
database deadlocks, "wt.pom.sessionTransactionLockMonitor" should be sufficient 
since the information will be displayed when the database detects the deadlock error. 
Additional information can be obtained from the database to identify the specific
sessions that are involved and these can be correlated to the log messages.  Note
that for non-Oracle databases, the database server rolls back the transaction
prior to raising an error back to the MethodServer.   Therefore, the lock 
information for the other session involved in the deadlock that was not rolled 
back may not reflect the state at the time of the deadlock.  
</p>
<p>Another type of deadlock that can occur is when the locked resources exist in 
both the database and the Java Virutal Machine.  In this case, thread dumps can 
be used to show the Java locks and the "dumpTransactionLockMonitorSessionCache" 
MBean operation can be used
to show the database locks.  If the MethodServer appears to be hung or deadlocked,
then these JMX operations for explicitly dumping the log information can be
invoked.   If the issue does not appear regularly or is hard to reproduce, then
the periodic logging options can be used (for both active sessions and stacktraces).
</p>
<p>
Keep in mind that the database
locks that are logged are only the object locks that result from persistence
layer operations.  Other database locks are possible such as those caused by
external applications, direct database access, store procedures, direct JDBC
access, etc.
</p>


<br></div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><code>wt.fc</code></dd>
</dl>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-files/index-1.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../wt/pds/subStringIndex/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../wt/pom/concurrent/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../index.html?wt/pom/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
